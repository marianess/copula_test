{
    "collab_server" : "",
    "contents" : "\n# Try to fit bivariate copula to \n# max data. choise of\n# elements is arbitrary as\n# the goal is to learn R routine.\n\nlibrary(compositions)\nlibrary(copula)\nlibrary(VineCopula)\nlibrary(dplyr)\n\nhem <- read.csv(\"hem_sorted.txt\", header=TRUE, sep=\"\\t\")\nhem <- hem %>% filter(Drillhole != \"RD1988\")\nhem.log <- log1p(hem[,8:53])\n\n\n# plot several scatterplots to choose\n# variables for expiremental moelling\nplot(hem.log$Ta181,hem.log$Nb93)\nplot(hem.log$Nb93,hem.log$W182)\nplot(hem.log$Co59,hem.log$Pb208)\nplot(hem.log$V51,hem.log$GaAs75)\nplot(hem.log$La139,hem.log$Ni60)\nplot(hem.log$Mn55,hem.log$Ga69)\n\n###############\n#             #  \n# first pair  #\n#             #\n###############\n\n# plot pairs\nplot(hem.log$La139,hem.log$Ni60)\nabline(lm(hem.log$La139~hem.log$Ni60),col='red',lwd=1)\ncor(hem.log$La139,hem.log$Ni60,method='spearman')\n\n# decide which copula to select\nu <- pobs(as.matrix(hem.log$La139))\nv <- pobs(as.matrix(hem.log$Ni60))\nselectedCopula <- BiCopSelect(u,v,familyset=NA)\nselectedCopula\n\n# Bivariate copula: BB7 \n# (par = 1.12, par2 = 0.91, tau = 0.34)\n\n# Bivariate normal\n# create a 2D tCopul. pobs() converts data to uniform d.\nn.cop <- normalCopula(dim=2)\nset.seed(500)\nm <-pobs(as.matrix(cbind(hem.log$La139,hem.log$Ni60)))\n\n# fitting copula\nfit <- fitCopula(n.cop,m,method='ml')\nrho = coef(fit)[1]\npersp(normalCopula(dim=2,rho),dCopula)\n\n\n# build copula and sample from it 454 samples\nu<- rCopula(454, normalCopula(dim=2,rho))\nplot(u[,1],u[,2],pch='.', col=\"darkblue\")\ncor(u, method='spearman')\n\n# model the margnals\nLa_mu <- mean(hem.log$La139)\nLa_sd <- sd(hem.log$La139)\nNi_mu <- mean(hem.log$Ni60)\nNi_sd <- sd(hem.log$Ni60)\n\n# hist 1\ng <- hem.log$La139\nhist(g, density=20, breaks=10, prob=TRUE, \n     xlab=\"La\", ylim=c(0, 0.7), \n     main=\"normal curve over histogram\")\ncurve(dnorm(x, mean=La_mu, sd=La_sd), \n      col=\"darkblue\", lwd=2, add=TRUE, yaxt=\"n\")\n\n# hist 2\ng <- hem.log$Ni60\nhist(g, density=20, breaks=10, prob=TRUE, \n     xlab=\"Ni\", ylim=c(0, 0.8), \n     main=\"normal curve over histogram\")\ncurve(dnorm(x, mean=Ni_mu, sd=Ni_sd), \n      col=\"darkblue\", lwd=2, add=TRUE, yaxt=\"n\")\n\n\n# simulate data\ncopula_dist <- mvdc(copula=normalCopula(rho,dim=2), margins=c(\"norm\",\"norm\"),\n                    paramMargins=list(list(mean=La_mu, sd=La_sd),\n                                      list(mean=Ni_mu, sd=Ni_mu)))\n\n\nsim <- rMvdc(454,copula_dist)\n\n# plotting results\nplot(hem.log$La139,hem.log$Ni60,main='observed')\npoints(sim[,1],sim[,2],col='red')\nlegend('bottomright',c('Observed','Simulated'),col=c('black','red'),pch=21)\n\n\n\n\n###############\n#             #  \n# second pair #\n#             #\n###############\n\n# plot pairs\nplot(hem.log$Mn55,hem.log$Ga69)\nabline(lm(hem.log$Mn55~hem.log$Ga69),col='red',lwd=1)\ncor(hem.log$Mn55,hem.log$Ga69,method='pearson')\n\n# decide which copula to select\nu <- pobs(as.matrix(hem.log$Mn55))\nv <- pobs(as.matrix(hem.log$Ga69))\nselectedCopula <- BiCopSelect(u,v,familyset=NA)\nselectedCopula\n\n# Bivariate copula: Rotated Tawn type 2 180 degrees \n# (par = 1.64, par2 = 0.16, tau = 0.11) \n\n# Bivariate normal\n# create a 2D tCopul. pobs() converts data to uniform d.\nn.cop <- normalCopula(dim=2)\nset.seed(500)\nm <-pobs(as.matrix(cbind(hem.log$Mn55,hem.log$Ga69)))\n\n# fitting copula\nfit <- fitCopula(n.cop,m,method='ml')\nrho = coef(fit)[1]\npersp(normalCopula(dim=2,rho),dCopula)\n\n# build copula and sample from it 3965 samples\nu<- rCopula(454, normalCopula(dim=2,rho))\nplot(u[,1],u[,2],pch='.', col=\"darkblue\")\ncor(u, method='spearman')\n\n\n# model the margnals\nMn_mu <- mean(hem.log$Mn55)\nMn_sd <- sd(hem.log$Mn55)\nGa_mu <- mean(hem.log$Ga69)\nGa_sd <- sd(hem.log$Ga69)\n\n# plot hists and normal dist with mu and sigma\n# first element\nhist(hem.log$Mn55,breaks=30,main='Mn',col='cyan')\n\nhist(hem.log$Ga69,breaks=30,main='Ga',col='cyan')\n\n# simulate data\ncopula_dist <- mvdc(copula=normalCopula(rho,dim=2), margins=c(\"norm\",\"norm\"),\n                    paramMargins=list(list(mean=Mn_mu, sd=Mn_sd),\n                                      list(mean=Ga_mu, sd=Ga_sd)))\n\n\nsim <- rMvdc(454,copula_dist)\n\n# compute density\npdf_mvd <- dMvdc(sim,copula_dist)\n\n# compute cdf\ncdf_mvd <- pMvdc(sim,copula_dist)\n\n# # 3D plain scatterplot of the multivariate distribution\n# par(mfrow = c(1, 1))\n# scatterplot3d(sim[,1],sim[,2], pdf_mvd, color=\"red\", main=\"Density\", xlab = \"u1\", ylab=\"u2\", zlab=\"pMvdc\",pch=\".\")\n# scatterplot3d(sim[,1],sim[,2], cdf_mvd, color=\"red\", main=\"CDF\", xlab = \"u1\", ylab=\"u2\", zlab=\"pMvdc\",pch=\".\")\n# persp(copula_dist, dMvdc, xlim = c(0, 8), ylim=c(0, 8), main = \"Density\")\n# contour(copula_dist, dMvdc, xlim = c(0, 8), ylim=c(0, 8), main = \"Contour plot\")\n# persp(copula_dist, pMvdc, xlim = c(0, 8), ylim=c(0, 8), main = \"CDF\")\n# contour(copula_dist, pMvdc, xlim = c(0, 8), ylim=c(0, 8), main = \"Contour plot\")\n# \n\n# plotting results\nplot(hem.log$Mn55,hem.log$Ga69,main='observed')\npoints(sim[,1],sim[,2],col='red')\nlegend('bottomright',c('Observed','Simulated'),col=c('black','red'),pch=21)\n\n\n\n\n\n\n",
    "created" : 1482195380923.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3328184223",
    "id" : "B701AC35",
    "lastKnownWriteTime" : 1482213701,
    "last_content_update" : 1482213701011,
    "path" : "C:/Users/Maria/Desktop/R/examples/Copula/od_cop.R",
    "project_path" : "od_cop.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}